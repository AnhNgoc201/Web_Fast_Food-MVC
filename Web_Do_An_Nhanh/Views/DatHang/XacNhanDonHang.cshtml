@model Web_Do_An_Nhanh.Models.GioHang

@{
    ViewBag.Title = "Xác nhận đơn hàng";
    var user = ViewBag.KhachHang as Web_Do_An_Nhanh.Models.KhachHang;

    decimal tongTienHang = Model.TongThanhTien();
    decimal phiShip = Model.PhiShip ? 10000 : 0;
    decimal giamGia = tongTienHang * ((decimal)Model.PhanTramGiam / 100);
    decimal tongThanhToan = tongTienHang - giamGia + phiShip;
}

<div class="container mt-5">
    <h2 class="text-center text-danger mb-4">XÁC NHẬN ĐƠN HÀNG</h2>

    @if (user != null)
    {
        <div class="card shadow-sm p-4 mb-4">
            <h4 class="text-danger mb-3">Thông tin người nhận</h4>
            <p><strong>Họ tên:</strong> @user.TenKH</p>
            <p><strong>Địa chỉ:</strong> @user.DiaChi</p>
            <p><strong>Số điện thoại:</strong> @user.SDT</p>
        </div>
    }

    <div class="card shadow-sm p-4 mb-4">
        <h4 class="text-danger mb-3">Danh sách sản phẩm</h4>
        <table class="table table-bordered align-middle text-center">
            <thead class="table-danger">
                <tr>
                    <th>Tên sản phẩm</th>
                    <th>Đơn giá</th>
                    <th>Số lượng</th>
                    <th>Thành tiền</th>
                    <th>Phí ship</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.lst)
                {
                    <tr>
                        <td>@item.sTenSP</td>
                        <td>@String.Format("{0:N0} VNĐ", item.dDonGia)</td>
                        <td>@item.iSoLuong</td>
                        <td>@String.Format("{0:N0} VNĐ", item.ThanhTien)</td>
                        <td>@(Model.PhiShip ? "10.000 VNĐ" : "0 VNĐ")</td>
                    </tr>
                }
            </tbody>
        </table>

        <div class="mt-3">
            <div class="d-flex justify-content-between mb-2">
                <span>Tổng tiền hàng:</span>
                <span class="fw-bold">@String.Format("{0:N0} VNĐ", tongTienHang)</span>
            </div>

            @if (giamGia > 0)
            {
                <div class="d-flex justify-content-between mb-2 text-success">
                    <span>Giảm giá (@Model.PhanTramGiam%):</span>
                    <span class="fw-bold">-@String.Format("{0:N0} VNĐ", giamGia)</span>
                </div>
            }

            <div class="d-flex justify-content-between mb-2">
                <span>Phí vận chuyển:</span>
                <span class="fw-bold">@String.Format("{0:N0} VNĐ", phiShip)</span>
            </div>

            <hr />

            <div class="d-flex justify-content-between mb-2 text-danger fs-5">
                <span class="fw-bold">TỔNG THANH TOÁN:</span>
                <span class="fw-bold">@String.Format("{0:N0} VNĐ", tongThanhToan)</span>
            </div>
        </div>
    </div>

    @using (Html.BeginForm("ThanhToan", "DatHang", FormMethod.Post))
    {
        <div class="text-end mt-4">
            <a href="@Url.Action("XemGioHang", "DatHang")" class="btn btn-outline-secondary">
                ← Quay lại giỏ hàng
            </a>
            <button type="submit" class="btn btn-danger ms-2 px-4">
                Xác nhận thanh toán
            </button>
        </div>
    }
</div>
