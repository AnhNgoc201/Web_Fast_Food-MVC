@model Web_Do_An_Nhanh.Models.HoaDon

@{
    ViewBag.Title = "Chi Tiết Đơn Hàng #" + Model.MaHD;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .text-jollibee-danger {
        color: #dc3545 !important;
    }

    .bg-jollibee-primary {
        background-color: #fcc200 !important;
    }

    .table-responsive {
        border-radius: 0.5rem;
        overflow: hidden;
    }

    .order-summary-card {
        border-left: 5px solid #dc3545;
    }
</style>

<div class="container py-5">

    <h2 class="text-jollibee-danger fw-bolder mb-4">
        <i class="fas fa-receipt me-2"></i> CHI TIẾT ĐƠN HÀNG #@Model.MaHD
    </h2>

    <div class="row g-4">

        <div class="col-lg-5">
            <div class="card shadow-sm p-4 h-100 order-summary-card">
                <h4 class="fw-bold text-dark mb-3">THÔNG TIN CHUNG</h4>
                <ul class="list-unstyled mb-0">
                    <li class="mb-2">
                        <strong class="me-2">Ngày đặt:</strong>
                        <span class="float-end">@Model.NgayLap</span>
                    </li>
                    <li class="mb-2 pb-2 border-bottom">
                        <strong class="me-2">Trạng thái:</strong>
                        @{
                            // Xác định trạng thái và màu tương ứng
                            string statusText = Model.TinhTrang?.TenTT ?? "Đang xử lý";
                            string badgeClass2 = "bg-secondary text-white"; // mặc định

                            if (statusText.Contains("Đặt thành công"))
                            {
                                badgeClass2 = "bg-primary text-white";
                            }
                            else if (statusText.Contains("Chờ xác nhận"))
                            {
                                badgeClass2 = "bg-secondary text-white"; // xám
                            }
                            else if (statusText.Contains("Đang làm món"))
                            {
                                badgeClass2 = "bg-info text-dark"; // xanh nhạt
                            }
                            else if (statusText.Contains("Hoàn thành chế biến"))
                            {
                                badgeClass2 = "bg-success text-white"; // xanh lá
                            }
                            else if (statusText.Contains("Đang vận chuyển")
                                  || statusText.Contains("Đang giao"))
                            {
                                badgeClass2 = "bg-primary text-white"; // xanh dương
                            }
                            else if (statusText.Contains("Đã giao"))
                            {
                                badgeClass2 = "bg-success text-white"; // xanh lá
                            }
                            else if (statusText.Contains("Hủy") || statusText.Contains("Đã hủy"))
                            {
                                badgeClass2 = "bg-danger text-white"; // đỏ
                            }
                        }

                        <span class="float-end badge fs-6 p-2 shadow-sm @badgeClass2">
                            @statusText
                        </span>
                    </li>

                    <li class="mt-3">
                        <strong class="me-2">Địa chỉ giao hàng:</strong>
                        <p class="mt-1 mb-0 text-muted">@Model.DiaChi</p>
                    </li>
                    <li class="mt-3 pt-3 border-top">
                        <strong class="me-2 text-jollibee-danger">Tổng thanh toán:</strong>
                        <span class="float-end fw-bolder fs-4 text-jollibee-danger">
                            @string.Format("{0:N0} ₫", Model.TongTien)
                        </span>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-lg-7">
            <h4 class="fw-bold text-dark mb-3">DANH SÁCH MÓN ĂN</h4>
            <div class="table-responsive shadow-sm">
                <table class="table table-hover table-striped mb-0">
                    <thead class="bg-jollibee-primary text-dark fw-bold">
                        <tr>
                            <th scope="col">SẢN PHẨM</th>
                            <th scope="col" class="text-end">ĐƠN GIÁ</th>
                            <th scope="col" class="text-center">SỐ LƯỢNG</th>
                            <th scope="col" class="text-center">PHÍ SHIP</th>
                            <th scope="col" class="text-center">GIẢM GIÁ</th>
                            <th scope="col" class="text-end">THÀNH TIỀN</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.ChiTietHoaDons)
                        {
                            decimal giamGia = 0;
                            if (Model.KhuyenMai != null && Model.KhuyenMai.PhanTramGiam.HasValue)
                            {
                                giamGia = (item.DonGia * (decimal)Model.KhuyenMai.PhanTramGiam.Value / 100);
                            }
                            decimal thanhTien = (item.DonGia - giamGia) * item.SoLuong;
                            if (Model.PhiShip.GetValueOrDefault())
                            {
                                thanhTien += 10000; 
                            }
                            <tr>
                                <td>
                                    <img src="~/Content/Images/@item.SanPham.HinhAnh" alt="@item.SanPham.TenSP" style="width: 30px; height: 30px; object-fit: cover;" class="rounded-circle me-2" />
                                    @item.SanPham.TenSP
                                </td>
                                <td class="text-end">@string.Format("{0:N0} ₫", item.DonGia)</td>
                                <td class="text-center">@item.SoLuong</td>
                                <td class="text-center">
                                    @(Model.PhiShip.GetValueOrDefault() ? "10.000 VNĐ" : "0 VNĐ")
                                </td>
                                <td class="text-center">
                                    @(Model.KhuyenMai != null && Model.KhuyenMai.PhanTramGiam.HasValue ? Model.KhuyenMai.PhanTramGiam.Value + "%" : "-")
                                </td>
                                <td class="text-end fw-bold text-jollibee-danger">
                                    @string.Format("{0:N0} ₫", thanhTien)
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="text-end fw-bolder fs-5 mt-3 d-lg-none">
                Tổng tiền: @string.Format("{0:N0} ₫", Model.TongTien)
            </div>
        </div>
    </div>

    <hr class="my-4" />

    <a href="@Url.Action("LichSuMuaHang", "User")" class="btn btn-outline-secondary mt-3">
        <i class="fas fa-arrow-left me-2"></i> Quay lại Lịch sử mua hàng
    </a>
</div>
